library eth_abi_codec_test.multicall_decode_test;

import 'dart:convert';
import 'dart:io';
import 'dart:typed_data';

import 'package:convert/convert.dart';
import 'package:test/test.dart';
import 'package:eth_abi_codec/eth_abi_codec.dart';

void main() {
  var abi_file = File('./test_abi/MULTICALL.json');
  
  var abi = ContractABI.fromJson(
              jsonDecode(abi_file.readAsStringSync()));
  test('multicall encode aggregate', () {
    var call = ContractCall('aggregate')
      ..setCallParam('calls', [
          [
            '1bed2e134365055d76072642c3328f4899249a89',
            Uint8List.fromList(hex.decode('70a08231000000000000000000000000621b2b1e5e1364fb014c5232e2bc9d30dd46c1f0'))
          ],
          [
            '1bed2e134365055d76072642c3328f4899249a89',
            Uint8List.fromList(hex.decode('dd62ed3e000000000000000000000000621b2b1e5e1364fb014c5232e2bc9d30dd46c1f00000000000000000000000002f6b51a02367561a1d484ab5b006e7640d953c8b'))
          ]
        ]);
    final v = call.toBinary(abi);
    String e = '';
    if(v != null){
      e = hex.encode(v.toList());
    }
    expect(
      e,
      '252dba4200000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000001bed2e134365055d76072642c3328f4899249a890000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000002470a08231000000000000000000000000621b2b1e5e1364fb014c5232e2bc9d30dd46c1f0000000000000000000000000000000000000000000000000000000000000000000000000000000001bed2e134365055d76072642c3328f4899249a8900000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000044dd62ed3e000000000000000000000000621b2b1e5e1364fb014c5232e2bc9d30dd46c1f00000000000000000000000002f6b51a02367561a1d484ab5b006e7640d953c8b00000000000000000000000000000000000000000000000000000000');
  });
}